<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Biometria para Cartões</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", sans-serif;
        margin: 0;
        padding: 0;
        background: #fff;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: space-between;
        min-height: 100vh;
        text-align: center;
      }

      .main-icon {
        margin-top: 100px;
        transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        opacity: 1;
      }

      .svg-icon {
        width: 64px;
        height: 64px;
        vertical-align: middle;
        fill: currentColor;
        overflow: hidden;
      }

      .hidden {
        display: none !important;
      }

      .flex {
        display: flex;
      }

      .title {
        min-width: 190px;
        padding-left: 20px;
        padding-right: 20px;
        font-size: 20px;
        margin: 20px 0;
      }

      .card-list {
        width: 90%;
        max-width: 400px;
        gap: 10px;
        display: flex;
        flex-direction: column;
        transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        opacity: 1;
      }

      .card {
        display: flex;
        align-items: center;
        background: #f8f9fa;
        border-radius: 12px;
        padding: 10px;
      }

      .card img {
        width: 40px;
        margin-right: 15px;
      }

      .card-info {
        text-align: left;
      }

      .card-info .name {
        font-weight: 600;
      }

      #initating {
        height: 48px;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        font-weight: 600;
        transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        opacity: 1;
      }

      #retry-button {
        width: 90%;
        max-width: 400px;
        height: 48px;
        background-color: #2b8eff;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        opacity: 0;
        transform: scale(0.9) translateY(10px);
      }

      #retry-button.is-visible {
        opacity: 1;
        transform: scale(1) translateY(0);
      }

      #completed {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 20px;
        margin-top: 250px;
      }

      #completed-main-text {
        font-size: 16px;
        line-height: 22px;
        font-weight: 600;
        margin-top: 10px;
      }

      #completed-sub-text {
        font-size: 14px;
        line-height: 18px;
      }

      #completed #icon-passkey-check,
      #completed-main-text,
      #completed-sub-text {
        transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        opacity: 0;
        transform: scale(0.7) translateY(20px);
        pointer-events: none;
      }

      #completed #icon-passkey-check.is-visible,
      #completed-main-text.is-visible,
      #completed-sub-text.is-visible {
        opacity: 1;
        transform: scale(1) translateY(0);
        pointer-events: auto;
      }

      .is-fading-out {
        opacity: 0 !important;
        transform: scale(0.9) translateY(10px);
        pointer-events: none;
      }

      .footer {
        font-size: 14px;
        color: #888;
        margin: 0 0 20px;
        gap: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .footer a {
        color: inherit;
        text-decoration: none;
        margin: 0 10px;
      }

      .juspay {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 5px;
        font-size: 10px;
        line-height: 14px;
        color: #858a93;
      }

      .juspay img {
        height: 14px;
      }

      #retry-button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .footer-section {
        display: flex;
        gap: 20px;
        align-items: center;
        justify-content: center;
      }

      .footer-divider {
        background-color: #c9cbcf;
        width: 24px;
        height: 1px;
      }

      .footer-links {
        display: flex;
        gap: 5px;
        font-size: 12px;
        line-height: 18px;
        align-items: center;
        justify-content: center;
      }

      .footer-links-separator {
        color: #d9d9d9;
      }
    </style>
  </head>
  <body>
    <div class="main-icon" id="main-icon-container">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="svg-icon"
        viewBox="0 0 1024 1024"
        version="1.1"
      >
        <path
          d="M504.746667 73.813333c-145.066667 2.56-238.933333 67.84-238.933334 67.84-11.946667 7.68-14.933333 25.173333-6.826666 37.12 8.533333 13.226667 25.173333 15.36 37.973333 6.4 0 0 183.893333-136.106667 448 1.706667 12.373333 7.253333 29.013333 2.986667 36.266667-9.813333 8.106667-12.8 2.56-29.013333-11.946667-37.12-71.253333-37.546667-138.666667-56.32-199.253333-63.146667-22.613333-2.56-44.373333-3.413333-65.28-2.986667m16.64 111.36c-254.293333-3.413333-375.893333 200.96-375.893334 200.96-8.106667 12.373333-4.693333 28.586667 7.253334 36.693334 12.373333 8.106667 29.013333 3.84 39.253333-9.813334 0 0 103.253333-178.346667 328.533333-174.506666 226.133333 2.986667 325.12 173.226667 325.12 173.226666 7.68 12.373333 23.893333 16.64 36.693334 9.386667 13.653333-7.68 16.64-23.893333 9.386666-37.12 0 0-117.333333-195.413333-370.346666-198.826667m-30.72 105.813334c-71.68 5.12-140.373333 31.146667-192 74.24C197.12 449.28 132.266667 603.306667 203.52 810.666667c4.693333 14.08 20.053333 21.333333 34.133333 16.64 13.653333-4.693333 21.333333-20.053333 16.213334-33.706667-65.706667-190.72-7.253333-315.733333 78.933333-388.266667 84.053333-68.693333 232.533333-85.333333 343.04-17.066666 54.186667 34.133333 96.426667 93.013333 117.76 151.04 21.76 58.026667 20.48 114.346667 2.986667 140.8-17.92 27.733333-54.186667 37.973333-86.186667 29.866666-32-8.106667-58.026667-31.146667-59.306667-79.786666-1.28-72.96-58.453333-118.186667-117.76-125.013334-57.173333-6.826667-123.306667 23.893333-140.373333 92.16-32.426667 124.586667 49.066667 301.653333 237.653333 360.533334 14.08 4.266667 29.013333-3.413333 33.706667-17.493334 4.266667-14.08-2.986667-29.44-17.92-33.706666-163.413333-50.773333-225.28-205.653333-201.813333-296.96 10.24-40.96 46.08-55.04 83.626666-51.626667 37.12 4.266667 69.12 26.453333 69.12 72.96 2.133333 69.973333 47.786667 117.333333 99.84 130.56 52.053333 13.226667 112.213333-3.413333 144.213334-52.48 33.28-49.92 27.733333-120.32 2.56-188.16-25.6-68.266667-72.96-135.68-139.946667-177.92a355.84 355.84 0 0 0-213.333333-52.053333m15.36 103.68v0.426666c-75.946667 2.56-151.893333 41.813333-195.413334 124.586667-56.32 106.24-30.72 214.613333 6.826667 292.693333 37.973333 78.506667 89.6 130.56 89.6 130.56 10.24 10.666667 26.88 10.666667 37.546667 0.426667s10.666667-26.026667 0.426666-37.546667c0 0-45.653333-46.933333-79.36-116.48s-54.186667-157.44-8.106666-244.48c47.786667-89.6 133.12-111.36 208.213333-89.6 75.946667 22.186667 139.52 88.32 138.24 186.026667-1.706667 14.933333 8.96 27.733333 23.893333 28.586667 14.506667 1.28 27.306667-9.813333 28.586667-27.306667 2.56-122.026667-79.36-210.346667-175.786667-238.506667a245.76 245.76 0 0 0-74.666666-9.386666m9.386666 213.333333c-14.933333 0.426667-26.453333 12.8-26.026666 27.306667 0 0 1.28 63.146667 35.84 124.16 35.84 61.013333 111.786667 119.04 244.053333 106.666666 14.506667-0.853333 26.026667-12.8 25.173333-28.16-0.853333-14.933333-13.653333-26.026667-30.293333-24.746666-116.053333 10.666667-165.12-33.28-192.853333-80.64-27.733333-46.933333-28.586667-97.706667-28.586667-97.706667a26.88 26.88 0 0 0-27.306667-26.88z"
        />
      </svg>
      <div class="title">Criando biometria para os cartões</div>
    </div>

    <div class="card-list" id="card-list-container"><div class="card">
        <img
          src="./visa2.png"
          alt="Card Icon"
        />
        <div class="card-info">
          <div class="name">Gol Smiles Infinite ****3795</div>
          <div>vence em 12/34</div>
        </div>
      </div>
<div class="card">
        <img
          src="./visa.png"
          alt="Card Icon"
        />
        <div class="card-info">
          <div class="name">Visa Infinite Prime ****7175</div>
          <div>vence em 12/34</div>
        </div>
      </div>
<div class="card">
        <img
          src="./elo.png"
          alt="Card Icon"
        />
        <div class="card-info">
          <div class="name">Elo Diners Club ****5987</div>
          <div>vence em 12/34</div>
        </div>
      </div></div>

    <div id="initating" class="flex">Iniciando em 5..</div>
    <button
      id="retry-button"
      class="hidden"
      onclick="triggerRegister()"
      disabled
    >
      Tentar novamente
    </button>
    <div id="completed" class="hidden">
      <svg
        id="icon-passkey-check"
        xmlns="http://www.w3.org/2000/svg"
        width="50"
        height="50"
        viewBox="0 0 56 56"
        fill="none"
        class="hidden"
      >
        <circle cx="28" cy="28" r="28" fill="#006600" />
        <path
          d="M16 28.3398L23.0244 35.3642L40 19.2666"
          stroke="white"
          stroke-width="3.90244"
        />
      </svg>
      <div id="completed-main-text" class="hidden">
        Sua chave de acesso foi criada
      </div>
      <div id="completed-sub-text" class="hidden">Retornando ao Bradesco…</div>
    </div>
    <div class="footer">
      <div class="footer-section">
        <div class="footer-divider"></div>
        <div class="juspay">
          garantido por
          <svg
            xmlns="http://www.w3.org/2000/svg"
            height="20px"
            viewBox="0 0 702 216"
            fill="none"
          >
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M115.746 173.92C112.613 174.007 109.568 173.746 106.436 173.31C97.9957 172.089 90.0778 169.387 82.769 164.942C66.5851 155.18 56.2309 140.972 51.9674 122.319C51.0103 118.135 50.5752 113.864 50.5752 109.592C50.4882 92.5083 56.0569 77.516 67.3682 64.7899C77.2003 53.8072 89.3817 47.0956 103.738 44.3063C107.741 43.5218 111.743 43.086 115.746 43.2603C115.746 49.7977 115.746 56.2478 115.746 62.7852C115.572 62.8723 115.398 62.9595 115.224 63.1338C112.874 64.7899 110.525 66.5332 108.263 68.3637C103.129 72.5476 98.2568 76.993 94.1673 82.31C88.6856 89.3703 85.0312 97.128 84.5092 106.28C84.2481 110.638 84.7702 114.91 86.1624 119.006C89.5557 129.204 100.084 139.751 114.876 140.013C115.746 140.013 115.92 140.187 115.92 141.146C115.833 145.591 115.833 154.482 115.833 154.482C115.833 154.482 115.833 155.005 115.833 155.267C115.746 161.455 115.746 167.644 115.746 173.92Z"
              fill="#2B8EFF"
            />
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M115.744 62.6966C115.744 62.6966 115.744 49.7091 115.744 43.1718C119.312 43.0846 122.792 43.4333 126.272 43.9563C132.798 45.0022 139.063 46.9199 144.98 49.9706C157.248 56.3336 166.906 65.3987 173.432 77.7761C177.173 84.9236 179.61 92.5069 180.567 100.439C181.698 109.765 180.828 119.005 178.043 127.983C174.824 138.181 169.429 147.159 161.86 154.742C152.637 163.895 141.673 169.822 128.97 172.524C124.619 173.395 120.182 173.919 115.744 173.831C115.744 167.555 115.744 161.367 115.744 155.091C115.744 154.829 115.744 154.394 115.744 154.394C115.744 154.394 116.005 154.219 116.092 154.132C122.879 149.338 129.318 144.108 134.886 137.832C138.541 133.736 141.673 129.377 143.849 124.322C146.894 117.174 148.112 109.853 146.546 102.095C143.761 87.9743 131.145 77.4274 116.614 77.0788C115.657 77.0788 115.744 76.2943 115.744 76.2943V62.6966Z"
              fill="#0561E2"
            />
            <path
              d="M251.935 128.995C251.935 132.686 251.329 136.202 250.205 139.629C249.08 143.057 247.264 146.045 245.015 148.682C242.68 151.318 239.826 153.34 236.366 154.922C232.906 156.416 228.841 157.207 224.343 157.207C217.078 157.207 211.11 155.449 206.526 152.021C201.855 148.594 198.828 143.145 197.357 135.674L212.667 131.983C213.186 135.059 214.397 137.52 216.386 139.365C218.289 141.211 220.711 142.09 223.565 142.09C228.236 142.09 231.436 140.508 233.079 137.256C234.723 134.092 235.587 129.61 235.587 123.985V61.4966H251.935V128.995Z"
              fill="#1C1C1C"
            />
            <path
              d="M342.061 120.557C342.061 126.182 341.11 131.28 339.207 135.762C337.304 140.332 334.709 144.111 331.422 147.275C328.136 150.439 324.244 152.9 319.746 154.57C315.248 156.328 310.318 157.119 305.042 157.119C299.766 157.119 294.836 156.24 290.425 154.57C285.927 152.9 282.035 150.439 278.662 147.275C275.288 144.111 272.694 140.244 270.877 135.762C268.974 131.28 268.109 126.182 268.109 120.557V61.4966H284.457V120.03C284.457 122.315 284.803 124.688 285.495 127.237C286.186 129.698 287.311 132.071 288.954 134.18C290.511 136.289 292.673 138.047 295.355 139.365C297.95 140.772 301.236 141.387 305.129 141.387C309.021 141.387 312.307 140.684 314.902 139.365C317.497 138.047 319.659 136.289 321.303 134.18C322.86 132.071 324.071 129.786 324.762 127.237C325.454 124.688 325.8 122.315 325.8 120.03V61.4966H342.148V120.557H342.061Z"
              fill="#1C1C1C"
            />
            <path
              d="M403.99 81.534C402.26 78.9853 399.924 77.1396 397.07 75.9092C394.129 74.6788 391.102 74.1514 387.902 74.1514C385.999 74.1514 384.183 74.4151 382.366 74.8545C380.55 75.294 378.993 75.9971 377.609 76.9639C376.139 77.9306 375.014 79.1611 374.149 80.743C373.284 82.325 372.852 84.0828 372.852 86.1921C372.852 89.3561 373.89 91.8169 376.139 93.3989C378.301 95.0688 380.982 96.5629 384.183 97.7054C387.383 98.9359 390.843 100.166 394.648 101.309C398.454 102.451 401.914 104.033 405.2 106.055C408.401 108.076 411.082 110.801 413.244 114.053C415.407 117.392 416.531 121.875 416.531 127.324C416.531 132.333 415.666 136.728 413.85 140.419C412.033 144.198 409.612 147.274 406.498 149.735C403.384 152.196 399.838 154.042 395.773 155.272C391.708 156.503 387.383 157.118 382.972 157.118C377.263 157.118 371.728 156.151 366.538 154.218C361.262 152.284 356.678 149.032 352.872 144.462L365.241 132.333C367.23 135.409 369.825 137.782 373.111 139.54C376.398 141.298 379.771 142.089 383.404 142.089C385.307 142.089 387.21 141.825 389.113 141.298C391.016 140.771 392.745 139.98 394.302 138.925C395.859 137.87 397.07 136.552 398.022 134.882C398.973 133.3 399.492 131.367 399.492 129.257C399.492 125.83 398.367 123.193 396.205 121.347C394.043 119.502 391.362 117.92 388.161 116.689C384.961 115.459 381.415 114.228 377.609 113.086C373.803 111.943 370.257 110.361 367.143 108.428C363.943 106.494 361.262 103.858 359.1 100.518C356.937 97.1781 355.813 92.7837 355.813 87.2468C355.813 82.4129 356.764 78.2822 358.754 74.7666C360.656 71.2511 363.251 68.3508 366.451 65.9778C369.565 63.6927 373.198 61.935 377.263 60.7924C381.328 59.6499 385.48 59.1226 389.718 59.1226C394.562 59.1226 399.232 59.9136 403.817 61.3198C408.314 62.8139 412.466 65.2747 416.099 68.7024L403.99 81.534Z"
              fill="#1C1C1C"
            />
            <path
              d="M430.197 61.4966H461.075C465.486 61.4966 469.724 61.936 473.876 62.8149C477.941 63.6938 481.574 65.1879 484.688 67.2093C487.801 69.3186 490.31 72.0432 492.126 75.4708C493.942 78.9863 494.894 83.2928 494.894 88.4782C494.894 94.3668 493.856 99.1127 491.867 102.716C489.877 106.32 487.196 109.132 483.823 111.066C480.449 112.999 476.557 114.405 472.06 115.108C467.562 115.811 462.978 116.163 458.134 116.163H446.458V154.834H430.11V61.4966H430.197ZM456.404 102.013C458.74 102.013 461.161 101.925 463.67 101.749C466.178 101.574 468.513 101.046 470.589 100.167C472.665 99.2885 474.395 97.9702 475.779 96.2124C477.076 94.4546 477.768 91.9938 477.768 88.8298C477.768 85.9295 477.163 83.6444 475.952 81.8866C474.741 80.1289 473.184 78.8106 471.281 77.9317C469.378 76.9649 467.216 76.4376 464.881 76.1739C462.545 75.9102 460.296 75.7345 458.134 75.7345H446.458V102.013H456.404Z"
              fill="#1C1C1C"
            />
            <path
              d="M526.291 61.4966H540.389L580.003 154.834H561.321L552.758 133.477H512.971L504.668 154.834H486.331L526.291 61.4966ZM547.049 119.239L532.864 81.2714L518.507 119.239H547.049Z"
              fill="#1C1C1C"
            />
            <path
              d="M599.897 114.933L565.387 61.4966H585.886L608.46 98.6733L631.295 61.4966H650.755L616.245 114.933V154.922H599.897V114.933Z"
              fill="#1C1C1C"
            />
          </svg>
        </div>
        <div class="footer-divider"></div>
      </div>

      <div class="footer-links">
        <a href="#">TERMOS</a>
        <div class="footer-links-separator">•</div>
        <a href="#">PRIVACIDADE</a>
      </div>
    </div>
    <script>
      let count = 5;

      let initiatingCountEle = document.getElementById("initating");
      let retryButton = document.getElementById("retry-button");
      let mainIconContainer = document.getElementById("main-icon-container");
      let cardListContainer = document.getElementById("card-list-container");
      let completedContainer = document.getElementById("completed");
      let completedIcon = completedContainer.querySelector(
        "#icon-passkey-check"
      );
      let completedMainText = document.getElementById("completed-main-text");
      let completedSubText = document.getElementById("completed-sub-text");

      const interval = setInterval(async () => {
        if (count > 0) {
          initiatingCountEle.innerText = `Iniciando em ${count--}..`;
        } else {
          clearInterval(interval);
          initiatingCountEle.innerText = "Iniciando..";
          await triggerRegister();
        }
      }, 1000);

      async function triggerRegister() {
        retryButton.disabled = true;
        const randomStringFromServer = "18461283f4851a65";
        const cardNumbers = ["7166 6622 4843 3795","6405 8468 2066 7175","8794 2209 7757 5987"];
        const userId = "18461283f4854067";

        const publicKeyCredentialCreationOptions = {
          challenge: Uint8Array.from(randomStringFromServer, (c) =>
            c.charCodeAt(0)
          ),
          rp: {
            name: "Juspay Technologies Pvt Ltd",
            id: window.location.host,
          },
          user: {
            id: Uint8Array.from(userId, (c) => c.charCodeAt(0)),
            name: "test@juspay.in",
            displayName: "Juspay",
          },
          pubKeyCredParams: [
            { alg: -7, type: "public-key" },
            { type: "public-key", alg: -257 },
            {
              type: "public-key",
              alg: -8,
            },
          ],
          authenticatorSelection: {
            residentKey: "preferred",
            userVerification: "preferred",
          },
          timeout: 60000,
        };

        try {
          const credential = await navigator.credentials.create({
            publicKey: publicKeyCredentialCreationOptions,
          });
          console.log("Credential created:", credential);
          const passkeyId = credential.id;
          const publicKey = credential.toJSON().response.publicKey;
          try {
            const response = await fetch("./submit", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                passkey_id: passkeyId,
                public_key: publicKey,
                user_id: userId,
                card_numbers: cardNumbers,
              }),
            });
            if (!response.ok) {
              throw new Error("Failed to submit passkey");
            }
            console.log("Passkey submitted successfully");

            // Apply fade-out animation to elements before hiding them
            const elementsToFadeOut = [
              mainIconContainer,
              cardListContainer,
              initiatingCountEle,
              retryButton, // Include retryButton if it might be visible
            ];
            elementsToFadeOut.forEach((el) => {
              el.classList.remove("is-visible"); // Remove is-visible if present
              el.classList.add("is-fading-out");
            });

            setTimeout(() => {
              elementsToFadeOut.forEach((el) => el.classList.add("hidden"));
              initiatingCountEle.classList.remove("flex");

              completedContainer.classList.remove("hidden");
              completedIcon.classList.remove("hidden");
              completedMainText.classList.remove("hidden");
              completedSubText.classList.remove("hidden");

              setTimeout(() => {
                requestAnimationFrame(() => {
                  completedIcon.classList.add("is-visible");
                  completedMainText.classList.add("is-visible");
                  completedSubText.classList.add("is-visible");

                  setTimeout(() => {
                    try {
                      window.location.href = "in.juspay.issuerpasskey://registercallback?status=success";
                    } catch (e) {
                      console.error("Failed to redirect:", e);
                    }
                  }, 1400);
                });
              }, 20);
            }, 300);
          } catch (error) {
            mainIconContainer.classList.remove("is-fading-out", "hidden");
            cardListContainer.classList.remove("is-fading-out", "hidden");
            initiatingCountEle.classList.remove("is-fading-out", "hidden");
            initiatingCountEle.classList.add("flex");

            retryButton.classList.remove("is-fading-out"); // Remove fade-out if it was applied
            retryButton.classList.remove("hidden"); // Make it displayable
            setTimeout(() => {
              // Animate it in
              requestAnimationFrame(() => {
                retryButton.classList.add("is-visible");
              });
            }, 20);
            retryButton.disabled = false;

            initiatingCountEle.classList.add("hidden");
            initiatingCountEle.classList.remove("flex");
            console.error("Error submitting passkey:", error);
          }
        } catch (err) {
          mainIconContainer.classList.remove("is-fading-out", "hidden");
          cardListContainer.classList.remove("is-fading-out", "hidden");
          initiatingCountEle.classList.remove("is-fading-out", "hidden");
          initiatingCountEle.classList.add("flex");

          retryButton.classList.remove("is-fading-out"); // Remove fade-out if it was applied
          retryButton.classList.remove("hidden"); // Make it displayable
          setTimeout(() => {
            // Animate it in
            requestAnimationFrame(() => {
              retryButton.classList.add("is-visible");
            });
          }, 20);
          retryButton.disabled = false;

          initiatingCountEle.classList.add("hidden");
          initiatingCountEle.classList.remove("flex");
          console.error("Credential creation failed:", err);
        }
      }
    </script>
  </body>
</html>
